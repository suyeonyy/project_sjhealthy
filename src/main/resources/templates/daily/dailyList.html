<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset='utf-8' />
    <title>일지</title>
    <style>
        /* body 스타일 */
        html, body {
          overflow: hidden;
          font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
          font-size: 14px;
        }
        /* 캘린더 위의 해더 스타일(날짜가 있는 부분) */
        .fc-header-toolbar {
          padding-top: 1em;
          padding-left: 1em;
          padding-right: 1em;
        }
    </style>
</head>
<div th:replace="~{fragment/header :: main-head}"></div>
<body style="padding:30px;">
<!-- calendar 태그 -->
<div id='calendar-container'>
    <div id='calendar'></div>
</div>
<!-- jquery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- fullcalendar CDN -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js'></script>
<!-- fullcalendar 언어 CDN -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js'></script>
<script th:inline="javascript">
    var dailyList = [[${dailyList}]];

    $(document).ready(function() {
        /*
        if(dailyList.length > 0){
            for(var i = 0; i < dailyList.length; i++){
                var selected = dailyList[i];
                var dailyDate = selected.dailyDate;
                var dailyTitle = selected.dailyTitle;

                //console.log("dailyDate",dailyDate);
                //console.log("dailyTitle",dailyTitle);
            }
        }
        */

        if(dailyList.length > 0){
            var events = [];
            for(var i = 0; i < dailyList.length; i++){
                var selected = dailyList[i];
                var dailyDate = selected.dailyDate;
                var dailyTitle = selected.dailyTitle;

                //var dateString = dailyList[i] + ""; //number타입으로 받아져, string타입으로 변경하기 위해 ""추가
                //console.log(typeof dateString);

                // 문자열을 연, 월, 일로 분리
                var year = dailyDate.substring(0, 4);
                var month = dailyDate.substring(4, 6) - 1; // 월은 0부터 시작
                var day = dailyDate.substring(6, 8);

                // 새로운 Date 객체 생성
                var date = new Date(year, month, day);

                // 날짜 형식을 출력
                var  startDate = date.toString(); //Thu Dec 12 2024 00:00:00 GMT+0900 (한국 표준시) 와 같은 날짜 객체로 변경

                //console.log("결과");
                //console.log(startDate);

                // 서버에서 받은 데이터(response)를 이벤트 객체로 변환하여 배열에 추가
                var event = {
                    title: dailyTitle,
                    start: dailyDate
                };
                events.push(event);

                /*
                // 위에서 생성된 FullCalendar 인스턴스에 이벤트 추가
                calendar.addEvent({
                    title: "테스트",    // 이벤트 제목
                    start: startDate,   // 이벤트 시작 시간
                    allDay: true        // 하루 종일 이벤트
                });
                */
           }
           initializeFullCalendar(events);
       }else{
            var events = [];
            initializeFullCalendar(events);
       }
    });



    function initializeFullCalendar(event1) {
        var calendarEl = $('#calendar')[0];

        //FullCalendar 생성 (한 번만 생성)
        var calendar = new FullCalendar.Calendar(calendarEl, {
            height: '700px', // calendar 높이 설정
            expandRows: true, // 화면에 맞게 높이 재설정
            slotMinTime: '08:00', // Day 캘린더에서 시작 시간
            slotMaxTime: '20:00', // Day 캘린더에서 종료 시간
            // 해더에 표시할 툴바
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                //right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek' //month, week, day, list
            },
            initialView: 'dayGridMonth', // 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
            //initialDate: '2021-07-15', // 초기 날짜 설정 (설정하지 않으면 오늘 날짜가 보인다.)
            navLinks: true, // 날짜를 선택하면 Day 캘린더나 Week 캘린더로 링크
            editable: true, // 수정 가능?
            selectable: true, // 달력 일자 드래그 설정가능
            nowIndicator: true, // 현재 시간 마크
            dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
            locale: 'ko', // 한국어 설정
            events: event1, // 초기화 시 events 배열 사용
            datesSet: function (info) {
                currentMonth = info.view.title;
                calendar.refetchEvents(); // FullCalendar에 이벤트 업데이트
            },
            select: function(arg) { // 캘린더에서 드래그로 이벤트를 생성할 수 있다.
                //클릭한 날짜
                var dailyDate = arg.startStr;
                dailyDate = dailyDate.replaceAll("-","");//날짜 yyyymmdd 형식으로 변경
                window.location.href = '../daily/dailyWriteDetail?dailyDate=' + encodeURIComponent(dailyDate);
            },
            eventClick : function(info){
                //console.log("등록된 일정 클릭");
                //console.log(info.event.start);
                var date = info.event.start;
                var year = date.getFullYear() + "";
                var month = (date.getMonth() + 1).toString().padStart(2, '0') + ""; // 월은 0부터 시작하므로 1을 더해야 합니다.
                var day = date.getDate().toString().padStart(2, '0') + "";

                // 원하는 형식으로 출력
                var dailyDate = year + month + day;
                //console.log("최종",dailyDate);

                window.location.href = '../daily/dailyRead?dailyDate=' + encodeURIComponent(dailyDate);
            }
        });

        // 캘린더 렌더링
        calendar.render();
    }
</script>
<a href="/sjhealthy">
    <button style="float: right;">메인</button>
</a>
<div th:replace="~{fragment/footer :: main-foot}"></div>
</body>
</html>